<% content_for :head do %>
<style type="text/css">
/* TODO(should): this does not belong here (also need to remove
   inline style from various elements) */
th { font-weight: bold; }
input[type=text] { width: 13em; }
select { width: 13em; }
</style>
<% end %>
<script type="text/javascript">
function enable_apply() {
  if ($("#clone_id").val() != "" && $("#clone_child").val() != "") {
    $("#clone_submit").removeAttr("disabled");
    $("#clone_revert").removeAttr("disabled");
  } else {
    $("#clone_submit").attr("disabled", "disabled");
    $("#clone_revert").attr("disabled", "disabled");
  }
}

$(function() {
  $("#clone_id")
    .bind("keyup change", function() {
      enable_apply();
    }).focus();
  $("#clone_child")
    .bind("keyup change", function() {
      enable_apply();
    }).focus();
});
</script>
<div class="ui-widget-content ui-corner-all" style="padding: 0.5em;">
<% form_for([ @cib, @res ]) do |f| %>
<% flash.each do |flash_type, message| %>
  <div id="flash-<%= flash_type %>" class="ui-state-<%= flash_type %> ui-corner-all" style="padding: 0.5em; margin-bottom: 0.5em;"><%=h message %></div>
<% end %>
<% @res.errors.each do |message| %>
  <div class="ui-state-error ui-corner-all" style="padding: 0.5em; margin-bottom: 0.5em;"><%=h message %></div>
<% end %>
<table>
  <tr>
    <th><%=h f.label :id, _('Clone ID') %></th>
    <th><%=h f.label :child, _('Child Resource') %></th>
  </tr>
  <tr>
    <td><%= f.text_field :id %></td>
    <td><%= f.select :child, options_for_select(([@res.child] + @cib.resources.select {|r|
        !r.has_key?(:children) || (r.has_key?(:children) && r[:type] == 'group')
      }.map{|r| r[:id] }).sort{|a,b| a.natcmp(b, true)}, @res.child) %></td>
  </tr>
  <tr><td>&nbsp;</td></tr>
  <tr>
    <td colspan="4" style="text-align: right;">
      <%= f.submit _('Create Clone'), { :disabled => true } %>
      <%= f.submit _('Revert Changes'), { :id => 'clone_revert', :name => 'revert', :disabled => true, :style => 'display: none;' } %>
      <%= f.submit _('Back'), { :id => 'clone_cancel', :name => 'cancel' } %>
    </td>
  </tr>
</table>
<% end %>
</div>

